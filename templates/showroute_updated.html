<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Route between the locations</title>
    {% load static %}
    {{map.header.render|safe}}
    <style>
        /* Old Styles */
        .info-panel {
            position: absolute;
            top: 10px;
            left: 30px;
            z-index: 1000;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            font-family: Arial, sans-serif;
            max-width: 320px;
            min-width: 280px;
        }

        /* New Styles for better responsiveness */
        @media only screen and (max-width: 768px) {
            .info-panel {
                top: 5px;
                left: 5px;
            }
            .toggle-button {
                right: -60px;
            }
            .places-list {
                max-height: 200px;
            }
        }

        @media only screen and (max-width: 480px) {
            .info-panel {
                top: 0;
                left: 0;
            }
            .toggle-button {
                right: -40px;
            }
            .places-list {
                max-height: 150px;
            }
        }
    </style>
</head>

<body>
    {% if map %}
    <div class="info-panel collapsed" id="infoPanel">
        <div class="toggle-button" onclick="togglePanel()">
            <img src="{% static 'route/routes_round.webp' %}" alt="Toggle panel">
        </div>
        <div class="panel-content">
            <h4>Информация о маршруте</h4>
            <p>Расстояние: {{ distance|floatformat:2 }} км</p>
            
            <div class="distance-input">
                <label for="min-distance">Минимальная дистанция до маршрута (км):</label>
                <input type="number" id="min-distance" value="{{ min_distance }}" step="0.1" min="0.1" max="10">
                <button onclick="updateDistance()">Применить</button>
            </div>

            <div class="marker-toggles">
                <div class="marker-toggle">
                    <input type="checkbox" id="toggle-attractions" {% if show_attractions %}checked{% endif %} onchange="toggleMarkers('attractions')">
                    <span class="color-indicator color-orange"></span>
                    <label for="toggle-attractions">Достопримечательности</label>
                </div>
                <div class="marker-toggle">
                    <input type="checkbox" id="toggle-hotels" {% if show_hotels %}checked{% endif %} onchange="toggleMarkers('hotels')">
                    <span class="color-indicator color-purple"></span>
                    <label for="toggle-hotels">Отели</label>
                </div>
            </div>
            
            <div class="places-list">
                <h5 class="attractions">Ближайшие достопримечательности</h5>
                <ul id="attractions-list">
                    {% for attraction in nearby_attractions %}
                    <li class="attraction" data-marker-id="marker-attraction-{{ forloop.counter }}">
                        <span class="name">{{ attraction.name }}</span>
                        <span class="distance">{{ attraction.distance|floatformat:2 }} км</span>
                    </li>
                    {% endfor %}
                </ul>

                <h5 class="hotels">Ближайшие отели</h5>
                <ul id="hotels-list">
                    {% for hotel in nearby_hotels %}
                    <li class="hotel" data-marker-id="marker-hotel-{{ forloop.counter }}">
                        <span class="name">{{ hotel.name }}</span>
                        <span class="distance">{{ hotel.distance|floatformat:2 }} км</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    {{map.html.render|safe}}

    <script>
        function updateDistance() {
            const minDistance = document.getElementById('min-distance').value;
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('min_distance', minDistance);
            window.location.replace(currentUrl.toString());
        }

        function toggleMarkers(type) {
            const isChecked = document.getElementById(`toggle-${type}`).checked;
            const currentUrl = new URL(window.location.href);
            if (type === 'attractions') {
                currentUrl.searchParams.set('show_attractions', isChecked);
            } else if (type === 'hotels') {
                currentUrl.searchParams.set('show_hotels', isChecked);
            }
            const minDistance = document.getElementById('min-distance').value;
            currentUrl.searchParams.set('min_distance', minDistance);
            window.location.replace(currentUrl.toString());
        }

        function togglePanel() {
            const panel = document.getElementById('infoPanel');
            panel.classList.toggle('collapsed');
        }

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const minDistance = urlParams.get('min_distance');
            if (minDistance) {
                document.getElementById('min-distance').value = minDistance;
            }
            const showAttractions = urlParams.get('show_attractions');
            const showHotels = urlParams.get('show_hotels');
            if (showAttractions !== null) {
                document.getElementById('toggle-attractions').checked = showAttractions === 'true';
            }
            if (showHotels !== null) {
                document.getElementById('toggle-hotels').checked = showHotels === 'true';
            }
            if (window.Android) {
